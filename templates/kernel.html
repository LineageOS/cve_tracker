{% extends "base.html" %}
{% block title %}LineageOS Kernel Tracker for {{ kernel.repo_name }}{% endblock %}
{% block head %}
  <script src="{{ url_for('static', filename='js/Progress.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ContextMenu.js') }}"></script>
{% endblock %}
{% block content %}
  <div id="status_ids">
    {% for s in status_ids -%}
      <div id={{ "status_" ~ s.short_id }}>
        {{ s.text }}
      </div>
    {%- endfor %}
  </div>

  <div id="deprecate-kernel-dialog" class="dialog" kernel_id={{ kernel.id }} deprecated={{ kernel.deprecated }}>
    <div class="title">
      Mark as
      {% if kernel.deprecated %}
        not deprecated
      {% else %}
        deprecated
      {% endif %}
    </div>
    <div class="content">
      {% if kernel.deprecated %}
        This kernel will be brought back from the dead.
      {% else %}
        This kernel will be buried forever.
      {% endif %}
    </div>
    <div class="actions">
      <button class="cancel">CANCEL</button>
      <button class="mark">MARK</button>
    </div>
  </div>

  <div id="cve-info-dialog" class="dialog">
    <div class="title">CVE-20YY-XXX</div>
    <div class="content">
      <label>Notes</label>
      <div class="notes"></div>
      <label>Links</label>
      <div class="links"></div>
    </div>
    <div class="actions">
      {% if authorized %}
        <button class="edit">EDIT</a>
      {% endif %}
      <button class="compare">COMPARE</a>
      <button class="close">CLOSE</button>
    </div>
  </div>

  <div id='cveinfodialog'>
    <b>Notes:</b><br/>
    <span id='cvenotes'></span>
    {% if authorized %}
      <a class='small button' onclick='editnotes(this);'>Edit</a>
    {% endif %}
    <br/>
    <b>Links:</b><br/>
    <span id='cvelinks'></span><br/>
    {% if authorized %}
      <a href='' id='cveeditlink' class='small button'>Edit CVE</a>
    {% endif %}
    <a href='' id='cvecomparelink' class='small button'>Compare to other kernels</a>
  </div>

  <div id='editnotesdialog' title='Edit CVE notes'>
    <textarea placeholder='Applicable versions/platforms...' type='text' name='notes' id='cvenotes_input' ></textarea><br/>
    <div id='editnoteserror'></div>
  </div>

  <div class="cves card container">
    <div class="header">
      <span class="title">
        {{ kernel.vendor }}/{{ kernel.device }}
        <a href="https://github.com/LineageOS/{{ kernel.repo_name }}" title="View on GitHub"><i class="mdi mdi-github-circle"></i></a>
      </span>
      <span class="subtitle">
        updated on {{ kernel.last_github_update.strftime('%b %d, %Y') }}
      </span>
      {% if devices %}
      <div id="devices" class="subtitle">
        <span>used by </span>
        {% for d in devices -%}
            <a class="device" href="https://github.com/LineageOS/{{ d }}">
              {{ d }}{% if not loop.last %},{% endif %}
            </a>
        {%- endfor %}
      </div>
      {% endif %}
      <div id="progress">
        <div id="progress-bar" value="{{ kernel.progress }}">
          <div id="progress-bar-inner"></div>
        </div>
        <div id="progress-value"></div>
      </div>
    </div>

    <div class="container">
      {% set counter = [0] %}
      {% for column in cves | slice(3) %}
      {% set cveloop = loop %}
        <div class="four columns">
          {% for c in column %}
            <div class="cve" id="{{ c.cve_name }}">
              <span onclick="openLinks('{{ c.cve_name }}', '{{ c.id }}')">{{ c.cve_name }}</span>
              <span class="status status-context-menu" kernel_id="{{ kernel.id }}" cve_id="{{ c.id }}" status_id="{{ patch_status[counter[0]] }}"></span>
            </div>
          {% if counter.append(counter.pop() + 1) %} {% endif %}
          {% endfor %}
        </div>
      {% endfor %}
    </div>
    {% if authorized %}
      <div class="actions container">
        <button id="open-deprecate-kernel-dialog">
          {% if kernel.deprecated %}
            MARK AS NOT DEPRECATED
          {% else %}
            MARK AS DEPRECATED
          {% endif %}
        </button>
      </div>
    {% endif %}
  </div>
{% endblock %}
{% block scripts %}
  <script src="{{ url_for('static', filename='js/cve.js') }}"></script>
  <script src="{{ url_for('static', filename='js/kernel.js') }}"></script>
  {% if authorized %}
    <script src="{{ url_for('static', filename='js/updates.js') }}"></script>
  {% endif %}
{% endblock %}
